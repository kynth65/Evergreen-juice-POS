# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

EvergreenJuice is a fully functional POS (Point of Sale) system for juice shops built with Laravel 12 backend and React 19 frontend using Inertia.js. The application provides comprehensive order processing, product and category management, real-time inventory tracking with low stock alerts, detailed sales analytics with interactive charts, user account management, and role-based access control (Admin/Cashier roles).

## Common Development Commands

### Frontend Development
- `npm run dev` - Start Vite development server
- `npm run build` - Build production assets
- `npm run build:ssr` - Build with server-side rendering
- `npm run lint` - Run ESLint with auto-fix
- `npm run format` - Format code with Prettier
- `npm run format:check` - Check code formatting
- `npm run types` - Run TypeScript type checking

### Backend Development
- `composer dev` - Start all services (Laravel server, queue worker, Vite)
- `composer dev:ssr` - Start with SSR support
- `php artisan serve` - Start Laravel development server only
- `vendor/bin/pint` - Run PHP CS Fixer (Laravel Pint)
- `composer test` or `php artisan test` - Run tests with Pest
- `./vendor/bin/pest` - Run Pest tests directly

### Database
- `php artisan migrate` - Run database migrations
- `php artisan migrate:fresh --seed` - Fresh migration with seeders
- Database: SQLite (database/database.sqlite)
- Seeders create:
  - Admin user (admin@example.com / password)
  - Cashier user (cashier@example.com / password)
  - Test user (test@example.com / password)
  - Sample categories (Juices, Smoothies, Add-ons)
  - Sample products with stock levels and pricing

## Architecture Overview

### Tech Stack
- **Backend**: Laravel 12 with PHP 8.4
- **Frontend**: React 19 with TypeScript
- **Bundling**: Vite with Laravel Vite Plugin
- **Styling**: TailwindCSS v4
- **UI Components**: Radix UI primitives with shadcn/ui patterns
- **Authentication**: Laravel Fortify with Sanctum tokens
- **Testing**: Pest PHP for backend tests
- **Code Quality**: ESLint, Prettier, Laravel Pint

### Key Framework Features
- **Inertia.js**: Seamlessly connects Laravel backend with React frontend
- **Laravel Wayfinder**: Auto-generates TypeScript route helpers and form actions
- **Server-Side Rendering**: Optional SSR support configured

### Directory Structure

**Backend (Laravel)**:
- `app/Http/Controllers/` - Controllers for Auth, Settings, POS, Products, Categories, Orders, Dashboard, Analytics, Account Management
- `app/Http/Middleware/` - Custom middleware (RoleMiddleware, HandleInertiaRequests, HandleAppearance)
- `app/Models/` - Eloquent models (User, Product, Category, Order, OrderItem)
- `routes/` - Route definitions (web.php, auth.php, settings.php)
- `database/migrations/` - Database schema migrations
- `database/seeders/` - Database seeders (UserSeeder, CategorySeeder, ProductSeeder)
- `tests/` - Pest PHP tests

**Frontend (React/TypeScript)**:
- `resources/js/pages/` - Inertia.js page components (auth, settings, pos, orders, products, analytics, dashboard, account management)
- `resources/js/components/` - Reusable React components organized by feature
  - `ui/` - Shadcn UI components (button, dialog, card, table, chart components, etc.)
  - `analytics/` - Analytics-specific components (charts, stat cards, data tables)
  - `dashboard/` - Dashboard widgets (product management, account management)
- `resources/js/actions/` - Auto-generated by Wayfinder (mirror Laravel controllers)
- `resources/js/hooks/` - Custom React hooks
- `resources/css/` - Stylesheets and TailwindCSS configuration

### Design System
- **Typography**: Afacad font family (located: `c:\Users\kynth\Downloads\Afacad,Lexend_Deca,Manrope\Afacad`)
- **Colors**: Dark green highlights (#15803D and variants), light neutral backgrounds, black text
- **Components**: Built with Radix UI primitives and class-variance-authority for variants
- **Icons**: Lucide React icon library for consistent iconography
- **Layout**: Responsive sidebar navigation with mobile support

## Development Workflow

### Code Quality
- Frontend code is automatically formatted with Prettier and linted with ESLint
- Backend code follows Laravel Pint standards (PSR-12)
- TypeScript strict mode enabled with comprehensive type checking

### Testing Strategy
- Use Pest PHP for backend testing
- GitHub Actions run lint and test workflows on push/PR to main/develop branches
- Tests run against PHP 8.4 with SQLite database

### Form Handling
- Laravel Wayfinder auto-generates TypeScript actions that mirror controller methods
- Forms use Inertia.js for seamless SPA-like experience
- Form validation handled on Laravel backend

## Implemented Features

### Core POS Functionality
- **Order Processing**: Multi-item checkout with automatic order number generation (ORD-XXXXXXXX format)
- **Payment Methods**: Support for cash, card, and digital wallet payments with cash_amount tracking for change calculation
- **Receipt Printing**: Dedicated receipt page with order details, items, totals, and cashier information
- **Real-time Inventory**: Automatic stock deduction on order completion with optional inventory tracking per product
- **Order Status**: Pending and completed order statuses with completion timestamps

### Product & Category Management (Admin Only)
- **Product CRUD**: Full create, read, update, delete operations for products
- **Category Management**: Organize products by categories with active/inactive states
- **Inventory Tracking**:
  - Stock quantity management with optional tracking flag
  - Low stock threshold alerts
  - Low stock and out-of-stock indicators
  - SKU support for product identification
- **Product Details**: Name, description, price, image URL, and active status

### User & Access Management
- **Role-Based Access Control**:
  - **Admin**: Full access to all features (dashboard, analytics, product/category management, order history, account management)
  - **Cashier**: Access to POS, dashboard, and viewing their own orders
- **User Management (Admin Only)**: Create, update, activate/deactivate user accounts
- **Authentication**: Complete auth system via Laravel Fortify
  - Login/Register with email verification support
  - Password reset functionality
  - Two-factor authentication (TOTP) with recovery codes
  - Confirm password for sensitive operations

### Analytics & Reporting (Admin Only)
- **Dashboard Statistics**:
  - Today's sales and order count
  - Weekly and monthly sales totals
  - Low stock product count
  - Recent orders (last 5)
  - Top selling products (last 30 days)
- **Comprehensive Analytics**:
  - Daily sales trends (last 30 days) with interactive charts
  - Top 10 selling products by quantity and revenue
  - Payment method breakdown (count and total)
  - Weekday analysis - best performing days
  - Hourly patterns - busiest hours
  - Monthly comparisons (current vs previous)
  - Weekly revenue trends (last 12 weeks)
  - Category performance metrics
- **Order History**: Filterable order list with search by:
  - Date range (from/to)
  - Cashier/user
  - Payment method
  - Order status
  - Order number or product name search

### Settings & Personalization
- **Profile Management**: Update name and email
- **Password Management**: Change password with current password verification
- **Two-Factor Authentication**:
  - Enable/disable 2FA with QR code setup
  - Recovery codes generation and viewing
  - Confirmation via OTP input
- **Appearance Settings**: Theme customization support (handled via HandleAppearance middleware)

### Data Models

**User Model**:
- Fields: name, email, password, role (admin/cashier), is_active
- Relations: hasMany Orders
- Scopes: active, admins, cashiers
- Methods: isAdmin(), isCashier()

**Product Model**:
- Fields: category_id, name, description, price, stock_quantity, low_stock_threshold, sku, image_url, is_active, track_inventory
- Relations: belongsTo Category, hasMany OrderItems
- Scopes: active, lowStock
- Methods: isLowStock(), isOutOfStock()

**Category Model**:
- Fields: name, description, is_active
- Relations: hasMany Products
- Scopes: active

**Order Model**:
- Fields: order_number, user_id, status, subtotal, discount_amount, total_amount, payment_method, payment_reference, cash_amount, notes, completed_at
- Relations: belongsTo User, hasMany OrderItems
- Scopes: completed, pending, today
- Methods: markAsCompleted()
- Auto-generates order_number on creation

**OrderItem Model**:
- Fields: order_id, product_id, product_name, unit_price, quantity, line_total
- Relations: belongsTo Order, belongsTo Product

### UI Components & Libraries
- **Radix UI Primitives**: Alert Dialog, Avatar, Button, Card, Checkbox, Dialog, Dropdown Menu, Input, Label, Select, Separator, Switch, Table, Tooltip, etc.
- **Chart.js**: Interactive charts for analytics (via react-chartjs-2)
- **Lucide React**: Icon library
- **Class Variance Authority**: Component variant management
- **Shadcn UI Pattern**: Custom UI components following shadcn/ui design patterns
- **Sidebar Navigation**: App-wide sidebar with collapsible sections and user menu
- **Form Handling**: Wayfinder-generated actions with client-side validation

## Route Structure

### Public Routes
- `/` - Welcome/landing page

### Authenticated Routes (All Users)
- `/dashboard` - Dashboard with stats and recent activity
- `/pos` - POS interface for order checkout
- `/orders/{order}/receipt` - View/print receipt (own orders only, or any for admin/cashier)

### Admin-Only Routes
- `/categories` - Category management (resource routes)
- `/products` - Product management (resource routes)
- `/orders` - View all orders
- `/orders/{order}` - View specific order details
- `/history` - Order history with advanced filtering
- `/analytics` - Comprehensive analytics dashboard
- `/sales-by-date` - API endpoint for date-specific sales data
- `/account-management` - User account management

### Cashier Routes
- `/my-orders` - View own order history

### Settings Routes (Authenticated)
- `/settings/profile` - Update profile information
- `/settings/password` - Change password
- `/settings/two-factor` - Enable/disable 2FA
- `/settings/appearance` - Theme/appearance settings

### Auth Routes
- `/login`, `/register`, `/forgot-password`, `/reset-password`
- `/verify-email`, `/two-factor-challenge`, `/confirm-password`

## Key Implementation Notes

### Role-Based Access
- Implemented via custom `RoleMiddleware`
- Routes are protected with `middleware('role:admin')` or `middleware('role:admin,cashier')`
- User model includes `isAdmin()` and `isCashier()` helper methods

### Order Processing Flow
1. User adds items to cart in POS interface
2. Validates stock availability before checkout
3. Creates order with pending status
4. Creates order items with snapshot of product details (product_name, unit_price)
5. Deducts stock if `track_inventory` is enabled
6. Marks order as completed with timestamp
7. Redirects to receipt page

### Inventory Management
- Products can opt-in/out of inventory tracking via `track_inventory` boolean
- Stock deduction happens in database transaction for consistency
- Low stock alerts based on `low_stock_threshold` field
- Real-time stock validation prevents overselling

### Analytics Implementation
- Uses SQLite date functions for grouping (strftime)
- Timezone-aware calculations using Laravel Carbon
- Default timezone: Application timezone (configure in config/app.php)
- All analytics convert to UTC for database queries
- Data aggregated using Laravel query builder with groupBy and aggregate functions

### Two-Factor Authentication
- Uses Laravel Fortify's built-in 2FA (TOTP-based)
- QR code generated for authenticator app scanning
- Recovery codes provided for account recovery
- OTP verification via input-otp library on frontend

### Frontend State Management
- Inertia.js handles state synchronization between Laravel and React
- Form state managed via Wayfinder-generated actions
- No additional state management library needed (Redux, Zustand, etc.)

### Development Notes
- Use `composer dev` to start all services concurrently (server, queue, vite)
- Wayfinder auto-generates TypeScript types from Laravel routes
- Run `npm run types` to check TypeScript errors without building
- Pint automatically formats PHP code to PSR-12 standards
- Prettier formats TypeScript/React with auto-import organization